axios.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').getAttribute("content");axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";let l;document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("calendar"),t=document.getElementById("openAddModalBtn"),n=document.getElementById("closeModalBtn"),i=document.getElementById("schedule-form"),a=document.getElementById("search-schedule"),d=document.getElementById("filter-date"),c=document.getElementById("filter-type"),m=document.getElementById("toggleCalendarView"),s=document.getElementById("toggleListView");if(!e){console.error('Calendar element with id "calendar" not found.');return}if(B(e),t&&t.addEventListener("click",()=>v()),n){const r=document.getElementById("scheduleModal");n.addEventListener("click",()=>g(r)),r.addEventListener("click",u=>{u.target===r&&g(r)})}document.addEventListener("keydown",r=>{const u=document.getElementById("scheduleModal");r.key==="Escape"&&u&&!u.classList.contains("hidden")&&g(u)}),i&&i.addEventListener("submit",L),a&&a.addEventListener("input",f),d&&d.addEventListener("change",f),c&&c.addEventListener("change",f),m&&m.addEventListener("click",T),s&&s.addEventListener("click",k)});function B(e){const t=(window.scheduleData||[]).map(n=>h(n));l=new FullCalendar.Calendar(e,{initialView:"dayGridMonth",headerToolbar:{left:"title",center:"dayGridMonth,timeGridWeek,timeGridDay",right:"today prev,next"},height:"auto",events:t,locale:"id",buttonText:{today:"Hari Ini",month:"Bulan",week:"Minggu",day:"Hari"},dayMaxEvents:!0,eventClick:n=>w(n.event),selectable:!0,select:n=>{v(n.start,n.end),l.unselect()},editable:!0,eventDrop:S,eventResize:b}),l.render(),I(window.scheduleData||[])}function h(e){return{id:e.id,title:e.title,start:e.start_time,end:e.end_time,backgroundColor:p(e.type),borderColor:p(e.type),extendedProps:{description:e.description||"",location:e.location||"",instructor:e.instructor||"",type:e.type||"class"}}}function p(e){return{class:"#4F46E5",meeting:"#F59E0B",personal:"#10B981"}[e]||"#4F46E5"}async function S(e){const t={id:e.event.id,start_time:e.event.start.toISOString(),end_time:e.event.end?e.event.end.toISOString():e.event.start.toISOString()};try{await E(t,e.event),o("Jadwal berhasil dipindahkan","success")}catch(n){console.error("Error updating schedule:",n),o("Gagal memindahkan jadwal","error"),e.revert()}}async function b(e){const t={id:e.event.id,start_time:e.event.start.toISOString(),end_time:e.event.end.toISOString()};try{await E(t,e.event),o("Jadwal berhasil diubah","success")}catch(n){console.error("Error updating schedule:",n),o("Gagal mengubah jadwal","error"),e.revert()}}async function E(e,t){return(await axios.put(`/schedule/${e.id}`,{...t.extendedProps,title:t.title,start_time:e.start_time,end_time:e.end_time})).data}function v(e=null,t=null){const n=document.getElementById("scheduleModal");if(!n)return;document.getElementById("modal-title").textContent="Tambah Jadwal Baru";const i=document.getElementById("schedule-form");if(i.reset(),i.querySelector("#schedule-id").value="",e&&(document.getElementById("start_time").value=new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString().slice(0,16)),t)document.getElementById("end_time").value=new Date(t.getTime()-t.getTimezoneOffset()*6e4).toISOString().slice(0,16);else if(e){const a=new Date(e);a.setHours(a.getHours()+1),document.getElementById("end_time").value=new Date(a.getTime()-a.getTimezoneOffset()*6e4).toISOString().slice(0,16)}n.classList.remove("hidden"),document.getElementById("title").focus()}function w(e){const t=document.getElementById("scheduleModal");if(!t)return;document.getElementById("modal-title").textContent="Edit Jadwal";const n=document.getElementById("schedule-form");n.reset(),n.querySelector("#schedule-id").value=e.id;const i={title:e.title,description:e.extendedProps.description,start_time:e.start?new Date(e.start.getTime()-e.start.getTimezoneOffset()*6e4).toISOString().slice(0,16):"",end_time:e.end?new Date(e.end.getTime()-e.end.getTimezoneOffset()*6e4).toISOString().slice(0,16):"",location:e.extendedProps.location,instructor:e.extendedProps.instructor,type:e.extendedProps.type};Object.keys(i).forEach(a=>{const d=n.querySelector(`#${a}`);d&&(d.value=i[a]||"")}),t.classList.remove("hidden")}function g(e){e&&e.classList.add("hidden")}async function L(e){var d,c,m;e.preventDefault();const t=e.target,n=new FormData(t),i=Object.fromEntries(n.entries()),a=i.id!=="";try{const s=a?await axios.put(`/schedule/${i.id}`,i):await axios.post("/schedule",i);g(document.getElementById("scheduleModal")),o(s.data.message||(a?"Jadwal berhasil diperbarui":"Jadwal berhasil ditambahkan"),"success"),y()}catch(s){console.error("Error submitting form:",((d=s.response)==null?void 0:d.data)||s),o(((m=(c=s.response)==null?void 0:c.data)==null?void 0:m.message)||"Terjadi kesalahan.","error")}}window.deleteSchedule=async function(e){if(confirm("Apakah Anda yakin ingin menghapus jadwal ini?"))try{const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),n=await axios.delete(`/schedule/${e}`,{headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}});o(n.data.message||"Jadwal berhasil dihapus","success"),g(document.getElementById("scheduleModal")),y()}catch(t){console.error("Error deleting schedule:",t),o("Gagal menghapus jadwal.","error")}};window.editSchedule=function(e){const t=l.getEventById(e);t?w(t):console.error(`Event with id ${e} not found.`)};function x(e){document.getElementById("calendar-view").classList.toggle("hidden",!e),document.getElementById("list-view").classList.toggle("hidden",e),document.getElementById("toggleCalendarView").classList.toggle("bg-[#4F46E5]",e),document.getElementById("toggleCalendarView").classList.toggle("text-white",e),document.getElementById("toggleListView").classList.toggle("bg-[#4F46E5]",!e),document.getElementById("toggleListView").classList.toggle("text-white",!e)}function T(){x(!0)}function k(){x(!1)}function f(){y()}async function y(){const e=document.getElementById("filter-type").value,t=document.getElementById("filter-date").value,n=document.getElementById("search-schedule").value;try{const a=(await axios.get("/schedule/data",{params:{type:e,date:t,search:n}})).data;window.scheduleData=a,l.removeAllEvents(),l.addEventSource(a.map(d=>h(d))),I(a)}catch(i){console.error("Error refreshing schedule data:",i),o("Gagal memuat data jadwal","error")}}function I(e){const t=document.getElementById("schedule-list");if(t){if(t.innerHTML="",!e||e.length===0){t.innerHTML='<div class="text-center text-gray-500 py-8">Tidak ada jadwal ditemukan</div>';return}e.forEach(n=>{t.appendChild(M(n))})}}function M(e){const t=document.createElement("div");t.className="flex space-x-6 group";const n=new Date(e.start_time),i=new Date(e.end_time),a=p(e.type);return t.innerHTML=`
        <div class="w-20 text-center">
            <div class="text-sm font-medium text-gray-500 dark:text-gray-400">${n.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}</div>
            <div class="text-xs text-gray-500 dark:text-gray-500">${i.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"})}</div>
        </div>
        <div class="flex-1 rounded-xl p-4 text-white group-hover:opacity-90 transition" style="background-color: ${a}">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="font-medium">${e.title||"Tanpa Judul"}</h3>
                    <p class="text-sm mt-1">${e.description||""}</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden sm:flex items-center space-x-4 text-sm">
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-map-marker-alt fa-fw"></i>
                            <span>${e.location||"-"}</span>
                        </div>
                        <div class="flex items-center space-x-1">
                            <i class="fas fa-user fa-fw"></i>
                            <span>${e.instructor||"-"}</span>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="text-white hover:text-gray-200 p-1" onclick="editSchedule(${e.id})" title="Edit"><i class="fas fa-edit"></i></button>
                        <button class="text-white hover:text-gray-200 p-1" onclick="deleteSchedule(${e.id})" title="Hapus"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            </div>
        </div>
    `,t}function o(e,t="info"){let n=document.getElementById("notification");n||(n=document.createElement("div"),n.id="notification",document.body.appendChild(n));const i={success:"bg-green-500",error:"bg-red-500",warning:"bg-yellow-500",info:"bg-blue-500"};n.className=`fixed top-5 right-5 px-6 py-3 rounded-lg shadow-lg text-white z-50 transform transition-all duration-300 ${i[t]||i.info}`,n.textContent=e,n.style.transform="translateX(0)",setTimeout(()=>{n.style.transform="translateX(120%)"},3e3)}
